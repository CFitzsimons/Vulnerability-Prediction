using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Net;
using System.Text;
using System.Threading.Tasks;
using VulnerabilityPrediction.Logging;

namespace VulnerabilityPrediction.Formatting
{
    
    public class UpdateService
    {
        private WebClient downloader;

        public UpdateService()
        {
            downloader = new WebClient();
        }
        public FileInfo GetLatestInstance()
        {
            string fileName = DateTime.Today.ToOADate() + ".csv";
            try
            {
                downloader.DownloadFile(new Uri(FileManager.LatestDatastore), Path.Combine(Environment.CurrentDirectory, fileName));
            }
            catch (WebException ex)
            {
                Logger.Log(ex);
                throw ex;
            }
            
            return new FileInfo(fileName);
        }

        public void UpdateRecords(string pathToUpdates)
        {
            using (CsvReader reader = new CsvReader(pathToUpdates))
            {
                foreach (string[] values in reader.RowEnumerator)
                {
                    
                }
            }
            throw new NotImplementedException();
        }

        public void GetLatestRecords()
        {
            throw new NotImplementedException();
        }
    }
}
